<div class="row">
  <div class="col-md-2 col-sm-3 col-xs-12">
    <div class="thumbnail" data-toggle="tooltip" title="PHP" data-placement="bottom">
    <%= link_to "/id/snap/integration_php.html" do image_tag("snap/php.jpg") end %>
    </div>
  </div>
  <div class="col-md-2 col-sm-3 col-xs-12">
    <div class="thumbnail" data-toggle="tooltip" title="Prestashop" data-placement="bottom">
    <%= link_to "/id/snap/integration_prestashop.html" do image_tag("snap/prestashop_gray.jpg") end %>
    </div>
  </div>
  <div class="col-md-2 col-sm-3 col-xs-12">
    <div class="thumbnail" data-toggle="tooltip" title="Magento" data-placement="bottom">
    <%= link_to "/id/snap/integration_magento.html" do image_tag("snap/magento_gray.jpg") end %>
    </div>
  </div>
  <div class="col-md-2 col-sm-3 col-xs-12">
    <div class="thumbnail" data-toggle="tooltip" title="Opencart" data-placement="bottom">
    <%= link_to "/id/snap/integration_opencart.html" do image_tag("snap/opencart_gray.jpg") end %>
    </div>
  </div>
  <div class="col-md-2 col-sm-3 col-xs-12">
    <div class="thumbnail" data-toggle="tooltip" title="Woocommerce" data-placement="bottom">
    <%= link_to "/id/snap/integration_woocommerce.html" do image_tag("snap/woocommerce_gray.jpg") end %>
    </div>
  </div>
  <div class="col-md-2 col-sm-3 col-xs-12">
    <div class="thumbnail" data-toggle="tooltip" title="WHMCS" data-placement="bottom">
    <%= link_to "/id/snap/integration_whmcs.html" do image_tag("snap/whmcs_gray.png") end %>
    </div>
  </div>
</div>

{::options parse_block_html="true" /}

<div class="tab-content">
<div class="tab-pane active">

### Tahapan Integrasi Snap

<ol>
  <li>Mendapatkan Snap Token</li>
  <li>Menampilkan Halaman Pembayaran Snap</li>
  <li>Status Transaksi</li>
  <li>Menangani Notifikasi</li>
</ol>

<br />

<!-- Nav tabs -->
<ul class="nav nav-tabs">
  <li class="active"><a href="#step1" data-toggle="tab"><span>Tahap 1</span>Mendapatkan Snap Token</a></li>
  <li><a href="#step2" data-toggle="tab"><span>Tahap 2</span>Menampilkan Halaman Pembayaran</a></li>
  <li><a href="#step3" data-toggle="tab"><span>Tahap 3</span>Status Transaksi</a></li>
  <li><a href="#step4" data-toggle="tab"><span>Tahap 4</span>Menangani Notifikasi</a></li>
</ul>

<div class="tab-content">
<div class="tab-pane active" id="step1"><!-- step 1-->
<!-- satu -->

## Mendapatkan Snap Token ##

Pada tahap ini, kita akan mencoba memperoleh Snap token untuk suatu pemesanan. Setidaknya ada 3 informasi yang dibutuhkan untuk mendapatkan Snap token, yaitu:

1. `server key`
2. ID transaksi
3. Nominal transaksi

<br>
Contoh kode PHP berikut digunakan untuk mendapatkan Snap token.

~~~ php
<?php
require_once(dirname(__FILE__) . 'Veritrans.php');

//Set Your server key
Veritrans_Config::$serverKey = "<Set your ServerKey here>";

// Uncomment for production environment
// Veritrans_Config::$isProduction = true;

Veritrans_Config::$isSanitized = true;
Veritrans_Config::$is3ds = true;

$transaction = array(
    'transaction_details' => array(
        'order_id' => "<your order_id>",
        'gross_amount' => 10000 // no decimal allowed
        )
    );

$snapToken = Veritrans_Snap::getSnapToken($transaction);
?>
~~~

<br />

Contoh kode di atas memanfaatkan library **Veritrans-PHP** yang dapat diunduh di [[Github](https://github.com/veritrans/veritrans-php/tree/snap) - [Zip](https://github.com/veritrans/veritrans-php/archive/snap.zip)] dan menggunakan mode sandbox/test.

File `Veritrans.php` diasumsikan berada pada direktori yang sama dengan kode sumber. Nilai `server_key` sudah dijelaskan di [Langkah Awal - Persiapan Awal](/id/welcome/preparation.html#step3)

Secara *default*, semua metode pembayaran yang Anda miliki akan ditampilkan di halaman Snap. Jika anda bermaksud menentukan metode pembayaran yang ditampilkan, ikuti petunjuk di [Snap - Fitur Tambahan](/id/snap/other_features.html). <br />

* * *

## Menambahkan Informasi Transaksi (Opsional)

Merchant dapat menambahkan berbagai data tambahan ke dalam variabel transaksi `$transaction`, seperti data pembeli, data pesanan barang, dan metode pembayaran. Data tambahan ini akan mempengaruhi halaman pembayaran Snap dan log transaksi pada MAP (Merchant Administration Portal).

Sebagian besar field pada form halaman Snap akan otomatis terisi dan Informasi terkait daftar barang serta lokasi pengiriman akan ditampilkan. Keterangan dan struktur lengkap data transaksi dalam bentuk JSON dapat dilihat di [Snap API Reference](https://snap-docs.midtrans.com).

Contoh kode PHP yang mengikutsertakan semua data transaksi adalah sebagai berikut:<br />

~~~ php
<?php
require_once(dirname(__FILE__) . 'Veritrans.php');

//Set Your server key
Veritrans_Config::$serverKey = "<Set your ServerKey here>";

// Uncomment for production environment
// Veritrans_Config::$isProduction = true;

Veritrans_Config::$isSanitized = true;
Veritrans_Config::$is3ds = true;

// Fill transaction details
$transaction_details = array(
  'order_id' => rand(),
  'gross_amount' => 145000, // no decimal allowed
);

// Optional, mandatory for mandiri bill payment
$item1_details = array(
    'id' => 'a1',
    'price' => 50000,
    'quantity' => 2,
    'name' => "Apple"
    );

// Optional
$item2_details = array(
    'id' => 'a2',
    'price' => 45000,
    'quantity' => 1,
    'name' => "Orange"
    );

// Optional, mandatory for mandiri bill payment
$item_details = array ($item1_details, $item2_details);

// Optional
$billing_address = array(
    'first_name'    => "Andri",
    'last_name'     => "Litani",
    'address'       => "Mangga 20",
    'city'          => "Jakarta",
    'postal_code'   => "16602",
    'phone'         => "081122334455",
    'country_code'  => 'IDN'
    );

// Optional
$shipping_address = array(
    'first_name'    => "Obet",
    'last_name'     => "Supriadi",
    'address'       => "Manggis 90",
    'city'          => "Jakarta",
    'postal_code'   => "16601",
    'phone'         => "08113366345",
    'country_code'  => 'IDN'
    );

$customer_details = array(
    'first_name'    => "Andri", //optional
    'last_name'     => "Litani", //optional
    'email'         => "andri@litani.com", //mandatory
    'phone'         => "081122334455", //mandatory
    'billing_address'  => $billing_address, //optional
    'shipping_address' => $shipping_address //optional
    );

// Fill transaction details
$transaction = array(
    'transaction_details' => $transaction_details,
    'customer_details' => $customer_details,
    'item_details' => $item_details,
    );

$snapToken = Veritrans_Snap::getSnapToken($transaction);
?>
~~~

<br />

* * *

## Respons saat Request Snap Token

| Kode | Keterangan | Contoh |
|-----------|-----------|---------|
|`201` |Sukses mendapatkan Snap Token.| "token": "d379aa71-99eb-4dd1-b9bb-eefe813746e9" |
|`400` |Gagal. Salah parameter.| "transaction_details.gross_amount is not equal to the sum of item_details" |
|`401` |Gagal. Salah akses key.| "Access denied, please check client or server key" |
|`500` |Gagal. Sistem error.| "Sorry, we encountered internal server error. We will fix this soon." |

</div><!-- end of step 1-->

<div class="tab-pane" id="step2"><!-- step 2-->

<!-- dua -->

## Menampilkan Halaman pembayaran Snap

Di tahap ini, kita akan mencoba untuk menampilkan halaman pembayaran Snap. Setidaknya ada 3 informasi yang dibutuhkan untuk menampilkan halaman pembayaran Snap.

1. `Client Key`
2. Snap.js
3. Snap token

Masukan `snap.js` di dalam halaman Anda sehingga modul Snap akan tersedia. Jangan lupa untuk mengisi `Client Key` sebagai nilai dari atribut data-client-key.

~~~ html
<html>
  <head>
    <script type="text/javascript"
            src="https://app.sandbox.midtrans.com/snap/snap.js"
            data-client-key="<Set Your Client Key Here>"></script>
  </head>
  <body>
    <button id="pay-button">Pay!</button>
    <script type="text/javascript">
      var payButton = document.getElementById('pay-button');
      payButton.addEventListener('click', function () {
        snap.pay('<?php echo $snap_Token; ?>'); // store your snap token here
      });
    </script>
  </body>
</html>
~~~

<br>

Mengacu pada langkah di atas, halaman Snap yang ditampilkan adalah sebagai berikut:

![snap](snap/snap01.png){: .img-responsive .img-thumbnail}

</div><!-- end of step 2-->

<div class="tab-pane" id="step3"><!-- step 3-->

<!-- Three -->

## Status Transaksi ##

Midtrans menyediakan tiga cara agar merchant dapat mengetahui status transaksi.

1. Notifikasi Email
2. Notifikasi HTTP(S)
3. Merchant Administration Portal


### Notifikasi Email

Setting notifikasi email dapat dikonfigurasi di [Settings - Email Notification](https://dashboard.sandbox.midtrans.com/settings/email_notifications) pada MAP.

![config_payment](snap/vtweb-emailnotif.png){: .img-responsive .img-thumbnail}

<div class="alert alert-info" role="alert">
  <span class="glyphicon glyphicon-info-sign" aria-hidden="true"> Info</span>
  <span class="sr-only">Info:</span><br>
  Gunakan koma sebagai pemisah apabila email lebih dari satu. Contoh : me@tokoecomm.com, you@tokoecomm.com
</div>

<br>

***

### Notifikasi HTTP(S) POST
Notifikasi melalui HTTP(S) POST akan dikirimkan ke server merchant ketika pelanggan menyelesaikan proses pembayaran. Anda dapat memakai *Notifikasi HTTP(S) POST* untuk memperbaharui status pembayaran atau mengirimkan barang transaksi secara langsung.

Endpoint notifikasi bisa di-set melalui MAP, di halaman [Settings - Configuration](https://dashboard.sandbox.midtrans.com/settings/vtweb_configuration/ "Midtrans VT-Web configuration page").
<br />
![config_payment](snap/vtweb-httpnotif.png){: .img-responsive .img-thumbnail}
<br />

<div class="alert alert-warning" role="alert">
  <span class="glyphicon glyphicon-warning-sign" aria-hidden="true"> Note</span>
  <span class="sr-only">Peringatan:</span><br>
Pastikan alamat notifikasi HTTP POST yang anda masukan tidak berupa alamat localhost.
</div>

<br>

Isi dari notifikasi HTTP(S) POST berupa JSON object.<br>Contoh notifikasi yang dikirimkan adalah sebagai berikut:

<ul class="nav nav-tabs">
  <li class="active"><a href="#statuscc" data-toggle="tab-code" data-lang="cc">Credit Card</a></li>
  <li><a href="#statuspermatava" data-toggle="tab-code" data-lang="permata">Permata VA</a></li>
  <li><a href="#statusmandiri" data-toggle="tab-code" data-lang="mandiri">Mandiri ClickPay</a></li>
  <li><a href="#statuscimb" data-toggle="tab-code" data-lang="cimb">CIMB Clicks</a></li>
  <li><a href="#statusbriepay" data-toggle="tab-code" data-lang="bri">ePay BRI</a></li>
  <li><a href="#statustcash" data-toggle="tab-code" data-lang="telkomsel">Telkomsel Cash</a></li>
  <li><a href="#statusxltunai" data-toggle="tab-code" data-lang="xl">XL Tunai</a></li>
  <li><a href="#statusmbill" data-toggle="tab-code" data-lang="mandiribill">Mandiri Bill Payment</a></li>
  <li><a href="#statusindomrt" data-toggle="tab-code" data-lang="indomaret">Indomaret</a></li>
  <li><a href="#statusdompetku" data-toggle="tab-code" data-lang="dompetku">Indosat Dompetku</a></li>
  <li><a href="#statusmandiriecash" data-toggle="tab-code" data-lang="mandiriecash">Mandiri Ecash</a></li>
  <li><a href="#statusbcava" data-toggle="tab-code" data-lang="bcava">BCA VA</a></li>
  <li><a href="#statusbcaklikpay" data-toggle="tab-code" data-lang="bcaklikpay">BCA KlikPay</a></li>
  <li><a href="#statusklikbca" data-toggle="tab-code" data-lang="klikbca">Klik BCA</a></li>
</ul>

<div class="tab-content"><!-- Status Tab Content-->
{::options parse_block_html="true" /}
<div class="tab-pane active" id="statuscc"><!-- step cc-->

### Credit Card

Contoh Notifikasi HTTP untuk transaksi kartu kredit yang berhasil:

~~~ json
{
  "status_code": "200",
  "status_message": "Veritrans payment notification",
  "transaction_id": "3a351906-2a89-47b6-8b88-d890e626ba4d",
  "masked_card": "481111-1114",
  "order_id": "VTCC001",
  "payment_type": "credit_card",
  "transaction_time": "2015-04-27 14:29:32",
  "transaction_status": "capture",
  "fraud_status": "accept",
  "approval_code": "1430119773366",
  "signature_key": "e192d421a3a4ad5c53d866d6591d75c3982e4019cd6f8954a0aa0d9387af44b983ca182c9c8b0fdfd5ba1ec2d10057f37b6dfb86742f5657800fa82282993e68",
  "bank": "mandiri",
  "eci": "05",
  "gross_amount": "145000.00"
}
~~~

<br>

#### Status Notifikasi HTTP(S) POST Yang Tersedia

| transaction_status | Definisi |
|---|---|
|capture | Transaksi berhasil dan siap untuk settlement.|
|cancel | Transaksi dibatalkan dan tidak akan diproses untuk settlement.|
|settlement | Dana transaksi berpindah dari akun pelanggan ke akun merchant.|
|deny | Transaksi ditolak oleh bank atau Sistem Deteksi Penipuan(FDS) Midtrans. |

<br>

| fraud_status | Definisi |
|---|---|
|accept | Transaksi diterima oleh FDS Midtrans. |
|challenge | Transaksi dianggap mencurigakan oleh FDS. Merchant harus menerima atau menolak transaksi secara manual. |
|deny | Transaksi ditolak oleh FDS Midtrans. |

<br>

Hasil transaksi antara transaction_status dan fraud_status

| transaction_status | fraud_status | Definisi |
|---|---|---|
|capture | **accept** | Transaksi berhasil |
|capture | **challenge** | Transaksi challenge (hit our FDS). Merchant harus `menerima` atau `menolak` transaksi secara manual. |
|deny | **any** | Transaksi ditolak |

<br>

* * *

### Status Transaksi Merchant Admin Portal(MAP)

Merchant dapat memeriksa status transaksi melalui menu [payments](https://dashboard.sandbox.midtrans.com/payments) di MAP.

Contoh transaksi status yang sukses untuk pembayaran kartu kredit:
![map_transaction](snap/map_transaction.png){: .img-responsive .img-thumbnail}

<br />

Daftar status transaksi yang tersedia di MAP untuk pembayaran Kartu Kredit adalah sebagai berikut:

| Status Transaksi | Definisi |
|---|---|
| Success | Transaksi diterima dan akan diproses untuk settlement.|
| Challenge | Transaksi kartu kredit dianggap mencurigakan oleh Sistem Deteksi Penipuan (FDS) Midtrans. Merchant harus menerima atau menolak transaksi secara manual melalui Midtrans Dashboard.|
| Failure | Transaksi Failure dapat diakibatkan oleh:<br> 1. Transaksi ditolak oleh Bank.<br>2. Transaksi Kartu Kredit ditolak oleh FDS Midtrans.|
| Cancel | Transaksi Cancel dapat diakibatkan oleh:<br>1. Transaksi yang sukses, dibatalkan sebelum proses Settlement.<br>2. Transaksi Challenge ditolak oleh merchant. |

</div> <!-- End of Credit Card Status -->

<div class="tab-pane" id="statuspermatava"><!-- Permata VA Status -->

### Permata Virtual Account

Contoh Notifikasi HTTP untuk transaksi Permata Virtual Account yang berhasil:

~~~ json
{
  "status_code": "200",
  "status_message": "Veritrans payment notification",
  "transaction_id": "9a31e442-951f-490d-9b9c-9e618ec98874",
  "order_id": "VTVA001",
  "payment_type": "bank_transfer",
  "transaction_time": "2015-04-27 14:39:16",
  "transaction_status": "settlement",
  "permata_va_number": "8778006776893528",
  "signature_key": "31b482e796c35153e829a85c59d831313694cd0c7cecdbb85a7a33474f431fbea75f440f57d09608ea1889a9eedd950017f1162ae37a2ec9b00084d932fb5309",
  "gross_amount": "145000.00"
}
~~~

<br>

#### Status Notifikasi HTTP(S) POST Yang Tersedia

| transaction_status | Definisi |
|---|---|
|pending | Transaksi pembayaran belum terproses dan masih menunggu untuk diselesaikan.|
|cancel | Transaksi sudah dibatalkan. Nomor VA Permata sudah tidak valid.|
|expire | Transaksi belum diselesaikan dan sudah melewati masa berlaku. Nomor VA Permata sudah tidak valid.|
|settlement | Dana transaksi berpindah dari akun pelanggan ke akun merchant.|

<br>


* * *

### Status Transaksi Merchant Admin Portal(MAP)

Merchant dapat memeriksa status transaksi melalui menu [payments](https://dashboard.sandbox.midtrans.com/payments) di MAP.

Contoh transaksi status yang sukses untuk pembayaran Permata Virtual Account:
![VT-Web transfer Test 3](snap/transfer_status.png){: .img-responsive .img-thumbnail}

<br />

Daftar status transaksi yang tersedia di MAP untuk pembayaran Permata Virtual Account adalah sebagai berikut:

|Transaction Status | Definisi |
|---|---|
| Pending | Transaksi belum diselesaikan dan akan menghasilkan status Pending.<br>Ketika pelanggan menyelesaikan pembayaran, status akan berubah menjadi 'Settlement'.|
| Settlement | Transaksi diterima.|
| Failure | Transaksi Failure dapat diakibatkan oleh:<br> 1. Transaksi ditolak oleh Bank.<br>2. Transaksi Pending belum dibayar dan sudah melewati masa berlaku.|

</div><!-- End of Permata VA Status -->
<div class="tab-pane" id="statusmandiri"><!-- Mandiri Status -->

### Mandiri Clickpay

Contoh Notifikasi HTTP untuk transaksi Mandiri clickpay yang berhasil:

~~~ json
{
  "status_code": "200",
  "status_message": "Veritrans payment notification",
  "transaction_id": "fdb6322d-2fef-42c5-a956-d6b575247f0b",
  "masked_card": "411111-1111",
  "order_id": "VTMC001",
  "payment_type": "mandiri_clickpay",
  "transaction_time": "2015-04-27 14:44:38",
  "transaction_status": "settlement",
  "fraud_status": "accept",
  "approval_code": "1430120681256",
  "signature_key": "6dfe98c7e8e1cc4725fa10d82e696816a04c5c0fdf819af3fef65d825b4b1cad0c024a3f1813f3cb590657d8cd3edabfb4e91dbb4376344f7460ed00637cd967",
  "gross_amount": "145000.00"
}
~~~

<br>

#### Status Notifikasi HTTP(S) POST Yang Tersedia

| transaction_status | Definisi |
|---|---|
|settlement | Dana transaksi berpindah dari akun pelanggan ke akun merchant.|
|deny | Transaksi ditolak oleh bank. |

<br>

* * *

### Status Transaksi Merchant Admin Portal(MAP)

Merchant dapat memeriksa status transaksi melalui menu [payments](https://dashboard.sandbox.midtrans.com/payments) di MAP.

Contoh transaksi status yang sukses untuk pembayaran Mandiri clickpay:
![VT-Web Mandiri Test 3](snap/mandiri_status.png){: .img-responsive .img-thumbnail}

<br />

Daftar status transaksi yang tersedia di MAP untuk pembayaran Mandiri Clickpay adalah sebagai berikut:

|Transaction Status | Definisi |
|---|---|
| Settlement | Transaksi diterima.|
| Failure | Transaksi ditolak oleh Bank.|

</div><!-- End of Mandiri Status -->
<div class="tab-pane" id="statuscimb"><!-- CIMB Status -->

### CIMB Clicks

Contoh Notifikasi HTTP untuk transaksi CIMB Clicks yang berhasil:

~~~ json
{
  "status_code": "200",
  "status_message": "Veritrans payment notification",
  "transaction_id": "47c11d2a-a8ca-4337-8681-8837ad023d65",
  "order_id": "VTCimb001",
  "payment_type": "cimb_clicks",
  "transaction_time": "2015-04-27 14:58:01",
  "transaction_status": "settlement",
  "approval_code": "1430121525724",
  "signature_key": "d70a32353c173b543b7580f8927a3c46c547ef4486457ca8b61f44eb644e7a76cccbbd244ec6f188d3ef8cc164950a02f8350e7d305fd635795b909aa0188975",
  "gross_amount": "145000.00"
}
~~~

<br>

#### Status Notifikasi HTTP(S) POST Yang Tersedia

| transaction_status | Definisi |
|pending | Transaksi belum terproses dan masih menunggu untuk diselesaikan. |
|cancel | Transaksi CIMB Clicks telah dibatalkan. |
|expire | Transaksi CIMB Clicks belum diselesaikan setelah 2 jam.|
|deny | Transaksi CIMB Clicks ditolak oleh bank. |
|settlement | Dana transaksi berpindah dari akun pelanggan ke akun merchant.|

<br>

* * *

### Status Transaksi Merchant Admin Portal(MAP)

Merchant dapat memeriksa status transaksi melalui menu [payments](https://dashboard.sandbox.midtrans.com/payments) di MAP.

Contoh transaksi status yang sukses untuk pembayaran CIMB Clicks:
![VT-Web CIMB Test 4](snap/cimb_status.png){: .img-responsive .img-thumbnail}

<br />

Daftar status transaksi yang tersedia di MAP untuk pembayaran CIMB Clicks adalah sebagai berikut:

|Transaction Status | Definisi |
|---|---|
| Pending | Transaksi belum diselesaikan dan akan menghasilkan status Pending.<br>Ketika pelanggan menyelesaikan pembayaran, status akan berubah menjadi 'Settlement'.|
| Settlement | Transaksi diterima.|
| Failure | Transaksi Failure dapat diakibatkan oleh:<br> 1. Transaksi ditolak oleh Bank.<br>2. Transaksi Pending belum dibayar dan sudah melewati masa berlaku.|

</div><!-- End of CIMB Status -->

<div class="tab-pane" id="statusbriepay"><!-- BRI E-Pay Status -->

### e-Pay BRI

Contoh Notifikasi HTTP untuk transaksi e-Pay BRI yang berhasil:

~~~ json
{
  "status_code": "200",
  "status_message": "Veritrans payment notification",
  "transaction_id": "3479c572-1d36-49c0-b5b1-22c876df411f",
  "order_id": "VTEB001",
  "payment_type": "bri_epay",
  "transaction_time": "2015-04-27 15:04:48",
  "transaction_status": "settlement",
  "fraud_status": "accept",
  "approval_code": "1430121888862",
  "signature_key": "39ec591fbf754982e0fb83d125b60ff1863b41878799d1adada69476d6f3b746631addce8bf51a9d7bb76d92cea5a4291d57ed4626c0dc8cfefa5f3112887bcd",
  "gross_amount": "145000.00"
}
~~~

<br>

#### Status Notifikasi HTTP(S) POST Yang Tersedia

| transaction_status | Definisi |
|---|---|
|pending | Transaksi belum terproses dan masi menunggu untuk diselesaikan. |
|cancel | Transaksi e-Pay BRI telah dibatalkan. |
|expire | Transaksi e-Pay BRI belum diselesaikan setelah 2 jam.|
|deny | Transaksi e-Pay BRI ditolak oleh bank. |
|settlement | Dana transaksi berpindah dari akun pelanggan ke akun merchant.|

<br>

* * *

### Status Transaksi Merchant Admin Portal(MAP)

Merchant dapat memeriksa status transaksi melalui menu [payments](https://dashboard.sandbox.midtrans.com/payments) di MAP.

Contoh transaksi status yang sukses untuk pembayaran e-Pay BRI:
![VT-Web epay Test 4](snap/epay_status.png){: .img-responsive .img-thumbnail}

<br />

Daftar status transaksi yang tersedia di MAP untuk pembayaran e-Pay BRI adalah sebagai berikut:

|Transaction Status | Definisi |
|---|---|
| Pending | Transaksi belum diselesaikan dan akan menghasilkan status Pending.<br>Ketika pelanggan menyelesaikan pembayaran, status akan berubah menjadi 'Settlement'.|
| Settlement | Transaksi diterima.|
| Failure | Transaksi Failure dapat diakibatkan oleh:<br> 1. Transaksi ditolak oleh Bank.<br>2. Transaksi Pending belum dibayar dan sudah melewati masa berlaku.|

<br>

</div><!-- End of BRI E-Pay Status -->
<div class="tab-pane" id="statustcash"><!-- T-Cash Status -->

### Telkomsel Cash

Contoh Notifikasi HTTP untuk transaksi Telkomsel Cash yang berhasil:

~~~ json
{
  "status_code": "200",
  "status_message": "Veritrans payment notification",
  "transaction_id": "ee925bec-3bef-43a6-bb10-cbe8ab8fa68a",
  "order_id": "Test-Order-6",
  "payment_type": "telkomsel_cash",
  "transaction_time": "2015-04-27 15:08:21",
  "transaction_status": "settlement",
  "signature_key": "a1ea0f3fd4690896464752a311fe0d7e53c9f75138f06c1cdd4d4d8bf7664214ff9ef2966a966e9507709041d6403f81ea2b3b76ce67f1437bc5e82913c4c545",
  "gross_amount": "145000.00"
}
~~~

<br>

#### Status Notifikasi HTTP(S) POST Yang Tersedia

| transaction_status | Definisi |
|---|---|
|deny | Transaksi Telkomsel Cash ditolak oleh provider. |
|settlement | Dana transaksi berpindah dari akun pelanggan ke akun merchant.|

<br>

* * *

### Status Transaksi Merchant Admin Portal(MAP)

Merchant dapat memeriksa status transaksi melalui menu [payments](https://dashboard.sandbox.midtrans.com/payments) di MAP.

Contoh transaksi status yang sukses untuk pembayaran Telkomsel Cash:
![VT-Web Tcash Test 3](snap/tcash_status.png){: .img-responsive .img-thumbnail}

<br />

Daftar status transaksi yang tersedia di MAP untuk pembayaran Telkomsel Cash adalah sebagai berikut:

|Transaction Status | Definisi |
|---|---|
| Settlement | Transaksi diterima dan sudah diproses untuk settlement.|
| Failure | Transaksi Failure dapat diakibatkan oleh:<br> 1. Transaksi ditolak oleh Bank. <br>2. Transaksi pending tidak dibayar hingga waktu expire tiba.|

</div><!-- End of T-Cash Status -->
<div class="tab-pane" id="statusxltunai"><!-- XL Tunai Status -->

### XL Tunai

Contoh Notifikasi HTTP untuk transaksi XL Tunai yang berhasil:

~~~ json
{
  "status_code": "200",
  "status_message": "Veritrans payment notification",
  "transaction_id": "1731610c-cbe5-4f59-a976-8206f3a59bc0",
  "order_id": "vtimage07",
  "payment_type": "xl_tunai",
  "transaction_time": "2015-04-27 15:20:40",
  "transaction_status": "settlement",
  "signature_key": "288f5b0f069d5d15383d1e0a13c34944c8681f5d0d1168727e9a3678581bda48736780b558567d16d35be9ee09f552f9a008f04980a5afef6bfc57a6df180f78",
  "gross_amount": "145000.00"
}
~~~

<br>

#### Status Notifikasi HTTP(S) POST Yang Tersedia

| transaction_status | Definisi |
|---|---|
|pending | Transaksi belum terproses dan masi menunggu untuk diselesaikan. |
|cancel | Transaksi XL Tunai telah dibatalkan. |
|expire | Transaksi XL Tunai belum diselesaikan setelah 2 jam.|
|deny | Transaksi XL Tunai ditolak oleh bank. |
|settlement | Dana transaksi berpindah dari akun pelanggan ke akun merchant.|

<br>


* * *

### Status Transaksi Merchant Admin Portal(MAP)

Merchant dapat memeriksa status transaksi melalui menu [payments](https://dashboard.sandbox.midtrans.com/payments) di MAP.

Contoh transaksi status yang sukses untuk pembayaran XL Tunai:
![VT-Web transfer Test 3](snap/xl_status.png){: .img-responsive .img-thumbnail}

<br />

Daftar status transaksi yang tersedia di MAP untuk pembayaran XL Tunai adalah sebagai berikut:

|Transaction Status | Definisi |
|---|---|
| Pending | Transaksi belum diselesaikan dan akan menghasilkan status Pending.<br>Ketika pelanggan menyelesaikan pembayaran, status akan berubah menjadi 'Settlement'.|
| Settlement | Transaksi diterima dan sudah diproses untuk settlement.|
| Failure | Transaksi Failure dapat diakibatkan oleh:<br> 1. Transaksi ditolak oleh Bank.<br>2. Transaksi Pending belum dibayar dan sudah melewati masa berlaku.|

</div><!-- End of XL Tunai Status -->
<div class="tab-pane" id="statusmbill"><!-- Mandiri BillPayment Status -->

### Mandiri Bill Payment

Contoh Notifikasi HTTP untuk transaksi Mandiri Bill Payment yang berhasil:

~~~ json
{
    "status_code": "200",
    "status_message": "Success, Mandiri Bill transaction is successful",
    "transaction_id": "0b53c7dc­e63c­4bbc­a371­6b1ca5c925c7",
    "order_id": "1421816431",
    "payment_type": "echannel",
    "transaction_time": "2015­01­21 12:00:31",
    "transaction_status": "settlement",
    "fraud_status": "accept",
    "biller_code": "70012",
    "bill_key": "000857123456",
    "signature_key": "e04f6657ee37f44c625282ac0a505cc1ea776901e51708823fe63921f47e24277868fc6f1e3ea1071074ab32455d679b47b20b4ad56a4ecba1d1dc9bbfa3aa80",
    "gross_amount": "400000.00"
}
~~~

<br>

#### Status Notifikasi HTTP(S) POST Yang Tersedia

| transaction_status | Definisi |
|---|---|
|pending | Transaksi belum terproses dan masih menunggu untuk diselesaikan. |
|cancel | Transaksi telah dibatalkan. Nomor Mandiri Bill sudah tidak valid. |
|expire | Transaksi belum diselesaikan setelah waktu berlaku. Nomor Mandiri Bill sudah tidak valid.|
|settlement | Dana transaksi berpindah dari akun pelanggan ke akun merchant.|

<br>


* * *

### Status Transaksi Merchant Admin Portal(MAP)

Merchant dapat memeriksa status transaksi melalui menu [Transaction](https://dashboard.sandbox.midtrans.com/payments) di MAP.

Contoh transaksi status yang sukses untuk pembayaran Mandiri Bill Payment:
![VT-Web mbill Test 3](snap/mbill_status.png){: .img-responsive .img-thumbnail}

<br />

Daftar status transaksi yang tersedia di MAP untuk pembayaran Mandiri Bill Payment adalah sebagai berikut:

|Transaction Status | Definisi |
|---|---|
| Pending | Transaksi belum diselesaikan dan akan menghasilkan status Pending.<br>Ketika pelanggan menyelesaikan pembayaran, status akan berubah menjadi 'Settlement'.|
| Settlement | Transaksi diterima dan sudah diproses untuk settlement.|
| Failure | Transaksi Failure dapat diakibatkan oleh:<br> 1. Transaksi ditolak oleh Bank.<br>2. Transaksi Pending belum dibayar dan sudah melewati masa berlaku.|

</div><!-- End of Mandiri BillPayment Status -->

<div class="tab-pane" id="statusindomrt"><!-- Indomaret Status -->

### Indomaret

Contoh Notifikasi HTTP untuk transaksi Indomaret yang berhasil:

~~~ json
{
  "status_code": "200",
  "status_message": "Veritrans payment notification",
  "transaction_id": "f8e2c3f8-e210-45ab-88ec-c0be989b0631",
  "order_id": "0900099957582",
  "gross_amount": "149000.00",
  "payment_type": "cstore",
  "transaction_time": "2017-01-19 14:39:01",
  "transaction_status": "settlement",
  "approval_code": "09211701070999568803",
  "signature_key": "4a14241267ff535503c65074407beb98fa81a2c031435afe5a5d523905d3ba3222427831945719ff285738dd28c4d32afeb7aca32f026070c58b9fa4520b3",
  "payment_code": "63756290009995",
  "store": "indomaret"
}
~~~

<br>

#### Status Notifikasi HTTP(S) POST Yang Tersedia

| transaction_status | Definisi |
|---|---|
|pending | Transaksi belum terproses dan masih menunggu untuk diselesaikan. |
|cancel | Transaksi telah dibatalkan. Nomor kode pembayaran Indomaret sudah tidak valid. |
|expire | Transaksi belum diselesaikan setelah waktu berlaku. Nomor kode pembayaran Indomaret sudah tidak valid.|
|settlement | Dana transaksi berpindah dari akun pelanggan ke akun merchant.|

<br>

* * *

### Status Transaksi Merchant Admin Portal(MAP)

Merchant dapat memeriksa status transaksi melalui menu [payments](https://dashboard.sandbox.midtrans.com/payments) di MAP.

Contoh transaksi status yang sukses untuk pembayaran Indomaret:
![VT-Web indomrt3](snap/indomrt_status.png){: .img-responsive .img-thumbnail}

<br />

Daftar status transaksi yang tersedia di MAP untuk pembayaran Mandiri Bill Payment adalah sebagai berikut:

|Transaction Status | Definisi |
|---|---|
| Pending | Transaksi belum diselesaikan dan akan menghasilkan status Pending.<br>Ketika pelanggan menyelesaikan pembayaran, status akan berubah menjadi 'Settlement'.|
| Settlement | Transaksi diterima dan sudah diproses untuk settlement.|
| Failure | Transaksi Failure dapat diakibatkan oleh:<br> 1. Transaksi ditolak oleh Bank.<br>2. Transaksi Pending belum dibayar dan sudah melewati masa berlaku.|

</div><!-- End of indomaret Status -->
<div class="tab-pane" id="statusdompetku"><!-- Indosat Dompetku Status -->

### Indosat Dompetku

Contoh Notifikasi HTTP untuk transaksi Indosat Dompetku yang berhasil:

~~~ json
{
  "status_code": "200",
  "status_message": "Veritrans payment notification",
  "transaction_id": "0b7696f1-f9ca-4f4b-a389-ede2c2dddb5c",
  "order_id": "vtdompetku03",
  "payment_type": "indosat_dompetku",
  "transaction_time": "2015-06-24 11:20:24",
  "transaction_status": "settlement",
  "signature_key": "73c70c8354e0705a16bd5d47d0ab3029a70b79bef0fe3b29161557110205d3679f0ea177101f56fe6313a887f340be7d302750ce8a4e0f67753c70548159895e",
  "gross_amount": "145000.00"
}
~~~

<br>

#### Status Notifikasi HTTP(S) POST Yang Tersedia

| transaction_status | Definisi |
|---|---|
|deny | Transaksi Indosat Dompetku ditolak oleh Indosat. |
|settlement | Dana transaksi berpindah dari akun pelanggan ke akun merchant.|

<br>

* * *

### Status Transaksi Merchant Admin Portal(MAP)

Merchant dapat memeriksa status transaksi melalui menu [payments](https://dashboard.sandbox.midtrans.com/payments) di MAP.

Contoh transaksi status yang sukses untuk pembayaran Indosat Dompetku:
![VT-Web dompetku Test 3](snap/dompetku_status.png){: .img-responsive .img-thumbnail}

<br />

Daftar status transaksi yang tersedia di MAP untuk pembayaran Indosat Dompetku adalah sebagai berikut:

|Transaction Status | Definisi |
|---|---|
| Settlement | Transaksi berhasil dan sudah diproses|
| Failure | Transaksi Failure karena ditolak oleh provider.|

</div><!-- End of Indosat Dompetku Status -->

<div class="tab-pane" id="statusmandiriecash"><!-- Mandiri E-cash Status -->

### Mandiri E-cash

Contoh Notifikasi HTTP untuk transaksi Mandiri E-cash yang berhasil:

~~~ json
{
  "status_code": "200",
  "status_message": "Veritrans payment notification",
  "transaction_id": "0b7696f1-f9ca-4f4b-a389-ede2c2dddb5c",
  "order_id": "vtecash03",
  "payment_type": "mandiri_ecash",
  "transaction_time": "2015-06-24 11:20:24",
  "transaction_status": "settlement",
  "signature_key": "73c70c8354e0705a16bd5d47d0ab3029a70b79bef0fe3b29161557110205d3679f0ea177101f56fe6313a887f340be7d302750ce8a4e0f67753c70548159895e",
  "gross_amount": "145000.00"
}
~~~

<br>

#### Status Notifikasi HTTP(S) POST Yang Tersedia

| transaction_status | Definisi |
|---|---|
|Pending | Proses pembayaran belum diselesaikan.|
|settlement | Pelanggan sudah menyelesaikan pembayaran dan berhasil.|
|expired | Pelanggan tidak menyelesaikan sampai batas waktu yang ditentukan.|

<br>


* * *

### Status Transaksi Merchant Admin Portal(MAP)

Merchant dapat memeriksa status transaksi melalui menu [payments](https://dashboard.sandbox.midtrans.com/payments) di MAP.

Contoh transaksi status yang sukses untuk pembayaran Mandiri E-cash:
![VT-Web mandiriecash](snap/mandiriecash_status.png){: .img-responsive .img-thumbnail}

<br />

Daftar status transaksi yang tersedia di MAP untuk pembayaran Mandiri E-cash adalah sebagai berikut:

|Transaction Status | Definisi |
|---|---|
|Pending | Transaksi belum diselesaikan dan akan menghasilkan status Pending.<br>Ketika pelanggan menyelesaikan pembayaran, status akan berubah menjadi 'Settlement'. |
|Settlement | Pelanggan sudah menyelesaikan pembayaran dan berhasil.|
|Failure | Pelanggan tidak menyelesaikan sampai batas waktu yang ditentukan.|

</div><!-- End of Mandiri E-cash Status -->

<div class="tab-pane" id="statusbcava"><!-- BCA VA Status -->

### BCA VA

Contoh Notifikasi HTTP untuk transaksi BCA VA yang berhasil:

~~~ json
{
    "va_numbers": [
          {
            "bank": "bca",
            "va_number": "05028708961"
          }
        ],
    "transaction_time": "2017-01-19 17:36:33",
    "gross_amount": "9000.00",
    "order_id": "test-1484822143",
    "payment_type": "bank_transfer",
    "signature_key": "cf2da321a084528d6bd4e66ee813212cb2ad0532ddfe2ac40c2cd38385b625ab20d426dbfa7d8729aeac36bb0f1c556a476d25945bc8b258f22f99895dade602",
    "status_code": "200",
    "transaction_id": "30bd8825-4673-488a-a03d-1ceda4930b15",
    "transaction_status": "settlement",
    "fraud_status": "accept",
    "status_message": "Veritrans payment notification"
}
~~~

<br>

#### Status Notifikasi HTTP(S) POST Yang Tersedia

| transaction_status | Definisi |
|---|---|
|Pending | Proses pembayaran belum diselesaikan.|
|settlement | Pelanggan sudah menyelesaikan pembayaran dan berhasil.|
|expired | Pelanggan tidak menyelesaikan sampai batas waktu yang ditentukan.|

<br>

* * *

### Status Transaksi Merchant Admin Portal(MAP)

Merchant dapat memeriksa status transaksi melalui menu [payments](https://dashboard.sandbox.midtrans.com/payments) di MAP.

Contoh transaksi status yang sukses untuk pembayaran BCA VA:
![Snap bcava](snap/bcava_status.png){: .img-responsive .img-thumbnail}

<br />

Daftar status transaksi yang tersedia di MAP untuk pembayaran Mandiri E-cash adalah sebagai berikut:

|Transaction Status | Definisi |
|---|---|
|Pending | Transaksi belum diselesaikan dan akan menghasilkan status Pending.<br>Ketika pelanggan menyelesaikan pembayaran, status akan berubah menjadi 'Settlement'. |
|Settlement | Pelanggan sudah menyelesaikan pembayaran dan berhasil.|
|Failure | Pelanggan tidak menyelesaikan sampai batas waktu yang ditentukan.|

</div><!-- End of BCA VA Status -->

<div class="tab-pane" id="statusbcaklikpay"><!-- BCA KlikPay Status -->

### BCA KlikPay

Contoh Notifikasi HTTP untuk transaksi BCA KlikPay yang berhasil:

~~~ json
{
    "approval_code": "112233",
    "transaction_time": "2017-01-19 15:40:43",
    "gross_amount": "33000.00",
    "order_id": "bcaklikpay01",
    "payment_type": "bca_klikpay",
    "signature_key": "644e39ab19d830b9ebcd2b4ae9f28c2dfaab06a33dd47d3fe2a94f2229b2478eb0606c43eec16e9836294b479b2e9867c309aad7a93a2d32d8b2f81c731f3379",
    "status_code": "200",
    "transaction_id": "1e22e73d-b496-41d6-a7b0-3acb763d2020",
    "transaction_status": "settlement",
    "fraud_status": "accept",
    "status_message": "Veritrans payment notification"
}
~~~

<br>

#### Status Notifikasi HTTP(S) POST Yang Tersedia

| transaction_status | Definisi |
|---|---|
|Pending | Proses pembayaran belum diselesaikan.|
|settlement | Pelanggan sudah menyelesaikan pembayaran dan berhasil.|
|expired | Pelanggan tidak menyelesaikan sampai batas waktu yang ditentukan.|

<br>

* * *

### Status Transaksi Merchant Admin Portal(MAP)

Merchant dapat memeriksa status transaksi melalui menu [payments](https://dashboard.sandbox.midtrans.com/payments) di MAP.

Contoh transaksi status yang sukses untuk pembayaran BCA KlikPay:
![Snap bcaklikpay](snap/klikpay_status.png){: .img-responsive .img-thumbnail}

<br />

Daftar status transaksi yang tersedia di MAP untuk pembayaran Mandiri E-cash adalah sebagai berikut:

|Transaction Status | Definisi |
|---|---|
|Pending | Transaksi belum diselesaikan dan akan menghasilkan status Pending.<br>Ketika pelanggan menyelesaikan pembayaran, status akan berubah menjadi 'Settlement'. |
|Settlement | Pelanggan sudah menyelesaikan pembayaran dan berhasil.|
|Failure | Pelanggan tidak menyelesaikan sampai batas waktu yang ditentukan.|

</div><!-- End of BCA KlikPay Status -->

<div class="tab-pane" id="statusklikbca"><!-- Klik BCA Status -->

### Klik BCA

Contoh Notifikasi HTTP untuk transaksi Klik BCA yang berhasil:

~~~ json
{
    "status_code": "200",
    "status_message": "Veritrans payment notification",
    "transaction_id": "63d28e4d-870a-43ea-a0ef-7739e0104f9a",
    "order_id": "jktrs11715",
    "gross_amount": "99000.00",
    "payment_type": "bca_klikbca",
    "transaction_time": "2017-01-13 14:50:02",
    "transaction_status": "settlement",
    "approval_code": "aius11715",
    "signature_key": "a2a6e288d6ab8e6d9101c99b4df1ee285d62fdd9e160a66a2d7463521dfc2a928224256a932963c2f4d8ee486d90123cfcef770651afc55a5fb8af00100477d4"
}
~~~

<br>

#### Status Notifikasi HTTP(S) POST Yang Tersedia

| transaction_status | Definisi |
|---|---|
|Pending | Proses pembayaran belum diselesaikan.|
|settlement | Pelanggan sudah menyelesaikan pembayaran dan berhasil.|
|expired | Pelanggan tidak menyelesaikan sampai batas waktu yang ditentukan.|

<br>

* * *

### Status Transaksi Merchant Admin Portal(MAP)

Merchant dapat memeriksa status transaksi melalui menu [payments](https://dashboard.sandbox.midtrans.com/payments) di MAP.

Contoh transaksi status yang sukses untuk pembayaran Klik BCA:
![Snap klikbca](snap/klikbca_status.png){: .img-responsive .img-thumbnail}

<br />

Daftar status transaksi yang tersedia di MAP untuk pembayaran Mandiri E-cash adalah sebagai berikut:

|Transaction Status | Definisi |
|---|---|
|Pending | Transaksi belum diselesaikan dan akan menghasilkan status Pending.<br>Ketika pelanggan menyelesaikan pembayaran, status akan berubah menjadi 'Settlement'. |
|Settlement | Pelanggan sudah menyelesaikan pembayaran dan berhasil.|
|Failure | Pelanggan tidak menyelesaikan sampai batas waktu yang ditentukan.|

</div><!-- End of Klik BCA Status -->

</div><!-- End of Tab-Content u/ Status -->

</div><!-- end of step 3-->

<div class="tab-pane" id="step4"><!-- step 4-->

## Menangani HTTP(S) Notifikasi

Berikut adalah contoh kode untuk menerima HTTP (POST) dan JSON object menggunakan Library **Veritrans-PHP**.<br> File ini adalah file PHP yang akan di eksekusi ketika URL endpoint notifikasi (https://tokoecomm.com/notification) diakses.<br />

<br>

~~~ php
<?php

require_once('Veritrans.php');
Veritrans_Config::$isProduction = false;
Veritrans_Config::$serverKey = '<your serverkey>';
$notif = new Veritrans_Notification();

$transaction = $notif->transaction_status;
$type = $notif->payment_type;
$order_id = $notif->order_id;
$fraud = $notif->fraud_status;

if ($transaction == 'capture') {
  // For credit card transaction, we need to check whether transaction is challenge by FDS or not
  if ($type == 'credit_card'){
    if($fraud == 'challenge'){
      // TODO set payment status in merchant's database to 'Challenge by FDS'
      // TODO merchant should decide whether this transaction is authorized or not in MAP
      echo "Transaction order_id: " . $order_id ." is challenged by FDS";
      }
      else {
      // TODO set payment status in merchant's database to 'Success'
      echo "Transaction order_id: " . $order_id ." successfully captured using " . $type;
      }
    }
  }
else if ($transaction == 'settlement'){
  // TODO set payment status in merchant's database to 'Settlement'
  echo "Transaction order_id: " . $order_id ." successfully transfered using " . $type;
  }
  else if($transaction == 'pending'){
  // TODO set payment status in merchant's database to 'Pending'
  echo "Waiting customer to finish transaction order_id: " . $order_id . " using " . $type;
  }
  else if ($transaction == 'deny') {
  // TODO set payment status in merchant's database to 'Denied'
  echo "Payment using " . $type . " for transaction order_id: " . $order_id . " is denied.";
  }
  else if ($transaction == 'expire') {
  // TODO set payment status in merchant's database to 'expire'
  echo "Payment using " . $type . " for transaction order_id: " . $order_id . " is expired.";
  }
  else if ($transaction == 'cancel') {
  // TODO set payment status in merchant's database to 'Denied'
  echo "Payment using " . $type . " for transaction order_id: " . $order_id . " is canceled.";
}
?>

~~~

<div class="alert alert-info" role="alert">
  <span class="glyphicon glyphicon-info-sign" aria-hidden="true"> Info</span>
  <span class="sr-only">Info:</span><br>
  Untuk keamanan, jika Merchant menggunakan _Veritrans_Notification_ seperti pada contoh di Library PHP, proses [challenge status](https://api-docs.midtrans.com/#handing-notifications) sudah dilakukan.
</div>

<br><br>

</div><!-- end of step 4-->
</div><!-- end of STEPS tab-content-->
</div><!-- end of header-->
